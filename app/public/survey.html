<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <title>Friend Finder</title>
</head>
<body>
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header"><h2>Survey Questions</h2></div>
                        <div class="card-body">
                            <h3>About You</h3>
                                <form>
                                    <div class="form-group">
                                        <label for="name">Name (Required)</label>
                                        <input type="text" class="form-control" id="name" placeholder="">
                                    </div>  
                                    <div class="form-group">
                                        <label for="photo">Link to Photo Image (Required)</label>
                                        <input type="link" class="form-control" id="photo" placeholder="">
                                    </div> 
                                </form> 
                                <h4>Question 1</h4>
                                <h5>You enjoy meeting new people.</h5>
                                <select class="choice" id= "q1">
                                    <option value="default">Select an Option</option>
                                    <option value = "1">1 (Strongly Disagree)</option>
                                    <option value = "2">2</option>
                                    <option value = "3">3</option>
                                    <option value = "4">4</option>
                                    <option value = "5">5 (Strongly Agree)</option>
                                </select>
                                <h4>Question 2</h4>
                                <h5>You like to try new activities.</h5>
                                <select class="choice" id= "q2">
                                    <option value="default">Select an Option</option>
                                    <option value = "1">1 (Strongly Disagree)</option>
                                    <option value = "2">2</option>
                                    <option value = "3">3</option>
                                    <option value = "4">4</option>
                                    <option value = "5">5 (Strongly Agree)</option>
                                </select>
                                <h4>Question 3</h4>
                                <h5>You like to try new activities.</h5>
                                <select class="choice" id= "q3">
                                    <option value="default">Select an Option</option>
                                    <option value = "1">1 (Strongly Disagree)</option>
                                    <option value = "2">2</option>
                                    <option value = "3">3</option>
                                    <option value = "4">4</option>
                                    <option value = "5">5 (Strongly Agree)</option>
                                </select>
                                <h4>Question 4</h4>
                                <h5>You like to try new activities.</h5>
                                <select class="choice" id= "q4">
                                    <option value="default">Select an Option</option>
                                    <option value = "1">1 (Strongly Disagree)</option>
                                    <option value = "2">2</option>
                                    <option value = "3">3</option>
                                    <option value = "4">4</option>
                                    <option value = "5">5 (Strongly Agree)</option>
                                </select>
                                <h4>Question 5</h4>
                                <h5>You like to try new activities.</h5>
                                <select class="choice" id= "q5">
                                    <option value="default">Select an Option</option>
                                    <option value = "1">1 (Strongly Disagree)</option>
                                    <option value = "2">2</option>
                                    <option value = "3">3</option>
                                    <option value = "4">4</option>
                                    <option value = "5">5 (Strongly Agree)</option>
                                </select>
                                <h4>Question 6</h4>
                                <h5>You like to try new activities.</h5>
                                <select class="choice" id= "q6">
                                    <option value="default">Select an Option</option>
                                    <option value = "1">1 (Strongly Disagree)</option>
                                    <option value = "2">2</option>
                                    <option value = "3">3</option>
                                    <option value = "4">4</option>
                                    <option value = "5">5 (Strongly Agree)</option>
                                </select>
                                <h4>Question 7</h4>
                                <h5>You like to try new activities.</h5>
                                <select class="choice" id= "q7">
                                    <option value="default">Select an Option</option>
                                    <option value = "1">1 (Strongly Disagree)</option>
                                    <option value = "2">2</option>
                                    <option value = "3">3</option>
                                    <option value = "4">4</option>
                                    <option value = "5">5 (Strongly Agree)</option>
                                </select>
                                <h4>Question 8</h4>
                                <h5>You like to try new activities.</h5>
                                <select class="choice" id= "q8">
                                    <option value="default">Select an Option</option>
                                    <option value = "1">1 (Strongly Disagree)</option>
                                    <option value = "2">2</option>
                                    <option value = "3">3</option>
                                    <option value = "4">4</option>
                                    <option value = "5">5 (Strongly Agree)</option>
                                </select>
                                <h4>Question 9</h4>
                                <h5>You like to try new activities.</h5>
                                <select class="choice" id= "q9">
                                    <option value="default">Select an Option</option>
                                    <option value = "1">1 (Strongly Disagree)</option>
                                    <option value = "2">2</option>
                                    <option value = "3">3</option>
                                    <option value = "4">4</option>
                                    <option value = "5">5 (Strongly Agree)</option>
                                </select>
                                <h4>Question 10</h4>
                                <h5>You like to try new activities.</h5>
                                <select class="choice" id= "q10">
                                    <option value="default">Select an Option</option>
                                    <option value = "1">1 (Strongly Disagree)</option>
                                    <option value = "2">2</option>
                                    <option value = "3">3</option>
                                    <option value = "4">4</option>
                                    <option value = "5">5 (Strongly Agree)</option>
                                </select>
                                <br>
                                <br>
                                <button type="button" class="btn btn-primary btn-lg btn-block" id = "submit">Submit</button>
                        </div>
            </div>

        </div>
    </div>

    <footer>
        <!-- <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script> -->
        <script src="https://code.jquery.com/jquery.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
        <script type="text/javascript">
            // $(".dropdown-item").on("click", function(event) {
            //     event.preventDefault();
            //     newVal = $(this).attr("value");

            //     // $(this).parents(".dropdown").find(".dropdown-toggle").text(value);
            //     // $(this).parents(".dropdown").find(".dropdown-toggle").addClass("disabled");

            // })
            $("#submit").on("click", function(event) {
                event.preventDefault();

                var newFriend = {
                    name: $('#name').val().trim(),
                    photo: $('#photo').val().trim(),
                    scores: [
                        $("#q1").val().trim(),
                        $("#q2").val().trim(),
                        $("#q3").val().trim(),
                        $("#q4").val().trim(),
                        $("#q5").val().trim(),
                        $("#q6").val().trim(),
                        $("#q7").val().trim(),
                        $("#q8").val().trim(),
                        $("#q9").val().trim(),
                        $("#q10").val().trim()
                    ]
                }
                console.log(newFriend);

                $.post("/api/friends", newFriend, function() {
                    console.log("New friend added!");

                    $("#name").val("");
                    $("#photo").val("");
                    $("#q1").val("default"),
                    $("#q2").val("default"),
                    $("#q3").val("default"),
                    $("#q4").val("default"),
                    $("#q5").val("default"),
                    $("#q6").val("default"),
                    $("#q7").val("default"),
                    $("#q8").val("default"),
                    $("#q9").val("default"),
                    $("#q10").val("default")
                })

                $.ajax({ url: "/api/friends", method: "GET"}).then(function(friendsData) {
                    var friendMatch = "";
                    function compareScores(){
                        var arrLength = friendsData.length -1;
                        var lastFriend = friendsData.slice(-1)[0].scores;
                        var difference = 0;
                        var difArr = [];
                        console.log(lastFriend);
                        for(var i=0; i < arrLength;i++){
                            for (var j=0; j < 10;j++){
                                difference += Math.abs(parseInt(lastFriend[j]) - parseInt(friendsData[i].scores[j]));
                            }
                            difArr.push(difference);
                            difference = 0;
                        }
                        console.log(difArr);
                        var leastDif = Math.min.apply(null, difArr);
                        console.log(leastDif);

                        function num(element) {
                            return element <= leastDif;
                        }
                        friendMatch = difArr.findIndex(num);

                        console.log(friendsData[friendMatch]);
                    }

                    compareScores();
                })


            })
        </script>
    </footer>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <title>Friend Finder</title>
</head>
<body>
    <div class="row">
        <div class="col-md-1"></div>
        <div class="col-md-10">
            <div class="card">
                <div class="card-header"><h2>Survey Questions</h2></div>
                        <div class="card-body">
                            <h4><b>About You</b></h4>
                                <form>
                                    <div class="form-group">
                                        <label class = "label" for="name"><h5>Name (Required)</h5></label>
                                        <input type="text" class="form-control" id="name" placeholder="">
                                    </div>  
                                    <div class="form-group">
                                        <label class = "label" for="photo"><h5>Link to Photo Image (Required)</h5></label>
                                        <input type="link" class="form-control" id="photo" placeholder="">
                                    </div> 
                                </form> 
                                <h4>Question 1</h4>
                                <h5>You enjoy meeting new people.</h5>
                                <select class="choice" id= "q1">
                                    <option value="default">Select an Option</option>
                                    <option value = "1">1 (Strongly Disagree)</option>
                                    <option value = "2">2</option>
                                    <option value = "3">3</option>
                                    <option value = "4">4</option>
                                    <option value = "5">5 (Strongly Agree)</option>
                                </select>
                                <br>
                                <br>
                                <h4>Question 2</h4>
                                <h5>You like to try new activities.</h5>
                                <select class="choice" id= "q2">
                                    <option value="default">Select an Option</option>
                                    <option value = "1">1 (Strongly Disagree)</option>
                                    <option value = "2">2</option>
                                    <option value = "3">3</option>
                                    <option value = "4">4</option>
                                    <option value = "5">5 (Strongly Agree)</option>
                                </select>
                                <br>
                                <br>
                                <h4>Question 3</h4>
                                <h5>You consider yourself a perfectionist.</h5>
                                <select class="choice" id= "q3">
                                    <option value="default">Select an Option</option>
                                    <option value = "1">1 (Strongly Disagree)</option>
                                    <option value = "2">2</option>
                                    <option value = "3">3</option>
                                    <option value = "4">4</option>
                                    <option value = "5">5 (Strongly Agree)</option>
                                </select>
                                <br>
                                <br>
                                <h4>Question 4</h4>
                                <h5>You like to plan things in advance.</h5>
                                <select class="choice" id= "q4">
                                    <option value="default">Select an Option</option>
                                    <option value = "1">1 (Strongly Disagree)</option>
                                    <option value = "2">2</option>
                                    <option value = "3">3</option>
                                    <option value = "4">4</option>
                                    <option value = "5">5 (Strongly Agree)</option>
                                </select>
                                <br>
                                <br>
                                <h4>Question 5</h4>
                                <h5>You would consider yourself an emotional person.</h5>
                                <select class="choice" id= "q5">
                                    <option value="default">Select an Option</option>
                                    <option value = "1">1 (Strongly Disagree)</option>
                                    <option value = "2">2</option>
                                    <option value = "3">3</option>
                                    <option value = "4">4</option>
                                    <option value = "5">5 (Strongly Agree)</option>
                                </select>
                                <br>
                                <br>
                                <h4>Question 6</h4>
                                <h5>You enjoy being alone.</h5>
                                <select class="choice" id= "q6">
                                    <option value="default">Select an Option</option>
                                    <option value = "1">1 (Strongly Disagree)</option>
                                    <option value = "2">2</option>
                                    <option value = "3">3</option>
                                    <option value = "4">4</option>
                                    <option value = "5">5 (Strongly Agree)</option>
                                </select>
                                <br>
                                <br>
                                <h4>Question 7</h4>
                                <h5>You pay close attention to detail.</h5>
                                <select class="choice" id= "q7">
                                    <option value="default">Select an Option</option>
                                    <option value = "1">1 (Strongly Disagree)</option>
                                    <option value = "2">2</option>
                                    <option value = "3">3</option>
                                    <option value = "4">4</option>
                                    <option value = "5">5 (Strongly Agree)</option>
                                </select>
                                <br>
                                <br>
                                <h4>Question 8</h4>
                                <h5>You are optimistic about the future.</h5>
                                <select class="choice" id= "q8">
                                    <option value="default">Select an Option</option>
                                    <option value = "1">1 (Strongly Disagree)</option>
                                    <option value = "2">2</option>
                                    <option value = "3">3</option>
                                    <option value = "4">4</option>
                                    <option value = "5">5 (Strongly Agree)</option>
                                </select>
                                <br>
                                <br>
                                <h4>Question 9</h4>
                                <h5>You enjoy outdoor activities.</h5>
                                <select class="choice" id= "q9">
                                    <option value="default">Select an Option</option>
                                    <option value = "1">1 (Strongly Disagree)</option>
                                    <option value = "2">2</option>
                                    <option value = "3">3</option>
                                    <option value = "4">4</option>
                                    <option value = "5">5 (Strongly Agree)</option>
                                </select>
                                <br>
                                <br>
                                <h4>Question 10</h4>
                                <h5>Other people would describe you as friendly.</h5>
                                <select class="choice" id= "q10">
                                    <option value="default">Select an Option</option>
                                    <option value = "1">1 (Strongly Disagree)</option>
                                    <option value = "2">2</option>
                                    <option value = "3">3</option>
                                    <option value = "4">4</option>
                                    <option value = "5">5 (Strongly Agree)</option>
                                </select>
                                <br>
                                <br>
                                <button type="button" class="btn btn-primary btn-lg btn-block" id = "submit" data-toggle = "modal" data-target = "#myModal"><i class="fas fa-check-circle"></i> Submit</button>
                        </div>
                        <div id = "myModal" class="modal" tabindex="-1" role="dialog">
                                <div class="modal-dialog" role="document">
                                  <div class="modal-content">
                                    <div class="modal-header">
                                      <h5 class="modal-title">Best Match</h5>
                                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                      </button>
                                    </div>
                                    <div class="modal-body">
                                        <h3 class = "match-name"></h3>
                                        <img class = "img-responsive" src = "" alt = " No image available" id = "showimg"/>
                                      
                                    </div>
                                    <div class="modal-footer">
                                      <button id = "close-btn" type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <p><a href = "/api/friends">API Friends List</a> | <a href ="https://github.com/zavanesova/FriendFinder">Github Repo</a></p>
            </div>

            <div class="col-md-1"></div>
        </div>
    </div>


    <footer>
        <!-- <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script> -->
        <script src="https://code.jquery.com/jquery.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
        <script type="text/javascript">
            $("#submit").on("click", function(event) {
                event.preventDefault();

                // prevents survey from being submitted unless all questions are answered.
                if ($(".choice").val() === "default" || $("#name").val() === "" || $("#photo").val() === "") {
                    alert("Please answer all questions before submitting.");
                    $('#myModal').hide();
                    $('.modal-content').hide();

                }else{
                
                // grabs value from forms and questionnaire results.
                var newFriend = {
                    name: $('#name').val().trim(),
                    photo: $('#photo').val().trim(),
                    scores: [
                        $("#q1").val().trim(),
                        $("#q2").val().trim(),
                        $("#q3").val().trim(),
                        $("#q4").val().trim(),
                        $("#q5").val().trim(),
                        $("#q6").val().trim(),
                        $("#q7").val().trim(),
                        $("#q8").val().trim(),
                        $("#q9").val().trim(),
                        $("#q10").val().trim()
                    ]
                }
                console.log(newFriend);

                // posts the new user's data to the friends array and /api/friends
                $.post("/api/friends", newFriend, function() {
                    console.log("New friend added!");
                    // clears the survey
                    $("#name").val("");
                    $("#photo").val("");
                    $("#q1").val("default"),
                    $("#q2").val("default"),
                    $("#q3").val("default"),
                    $("#q4").val("default"),
                    $("#q5").val("default"),
                    $("#q6").val("default"),
                    $("#q7").val("default"),
                    $("#q8").val("default"),
                    $("#q9").val("default"),
                    $("#q10").val("default")
                })

                // takes data from friends api and compares newest user to all previous users.
                $.ajax({ url: "/api/friends", method: "GET"}).then(function(friendsData) {
                    var friendMatch = "";
                    function compareScores(){
                        var arrLength = friendsData.length -1;
                        var lastFriend = friendsData.slice(-1)[0].scores;
                        var difference = 0;
                        var difArr = [];
                        console.log(lastFriend);
                        for(var i=0; i < arrLength;i++){
                            for (var j=0; j < 10;j++){
                                difference += Math.abs(parseInt(lastFriend[j]) - parseInt(friendsData[i].scores[j]));
                            }
                            difArr.push(difference);
                            difference = 0;
                        }
                        console.log(difArr);
                        var leastDif = Math.min.apply(null, difArr);
                        console.log(leastDif);

                        function num(element) {
                            return element <= leastDif;
                        }
                        friendMatch = difArr.findIndex(num);

                        console.log(friendsData[friendMatch]);
                    }

                    compareScores();
                    
                    // displays the friend match data in the modal.
                    $('#myModal').show();
                    $('.modal-content').show();
                    $(".match-name").text(friendsData[friendMatch].name);
                    $("#showimg").attr("src", friendsData[friendMatch].photo);
                     



                })
            }

            })
        </script>
    </footer>
</body>
</html>